<!-- Formular -->
<form id="anmeldeForm">
  <input type="text" id="name" placeholder="Name" required />
  <input type="email" id="email" placeholder="E-Mail" required />

  <label>
    <input type="radio" name="modus" value="Challenger" required />
    Challenger
  </label>
  <label>
    <input type="radio" name="modus" value="Champions" />
    Champions
  </label>

  <button type="submit">Anmelden</button>
</form>

<!-- Teilnehmerlisten -->
<h2>Challenger</h2>
<ul id="challengerList"></ul>

<h2>Champions</h2>
<ul id="championsList"></ul>

<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
  emailjs.init("3ZUOkztnnRkbxxd8O");

  async function ladeTeilnehmer() {
    const res = await fetch("/api/teilnehmer");
    const teilnehmer = await res.json();

    const challenger = teilnehmer.filter(t => t.modus === "Challenger");
    const champions = teilnehmer.filter(t => t.modus === "Champions");

    document.getElementById("challengerList").innerHTML = challenger.map(t => `<li>${t.name} (${t.email})</li>`).join("");
    document.getElementById("championsList").innerHTML = champions.map(t => `<li>${t.name} (${t.email})</li>`).join("");
  }

  document.getElementById("anmeldeForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;
    const modus = document.querySelector("input[name='modus']:checked").value;

    const res = await fetch("/api/anmelden", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, email, modus }),
    });

    const data = await res.json();

    if (data.success) {
      await emailjs.send("service_xk2haer", "template_gcgudle", { name, email, modus });
      alert("Erfolgreich angemeldet!");
      ladeTeilnehmer();
    } else {
      alert(data.error || "Fehler bei der Anmeldung.");
    }
  });

  ladeTeilnehmer();
</script>
